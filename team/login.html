<!DOCTYPE html>

<html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>MEMBER LOGIN | 篠ノ井技術クラブ</title> <link rel="stylesheet" href="/style.css"> <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script> <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script> <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet"> <style> body { background: #0b1d2e; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; overflow: hidden; } .login-card { background: rgba(16, 42, 67, 0.9); padding: 40px; border-radius: 24px; border: 1px solid #486581; box-shadow: 0 0 40px rgba(0, 0, 0, 0.3); text-align: center; width: 90%; max-width: 380px; backdrop-filter: blur(10px); transition: 0.5s; } .login-card.unlocked { border-color: #00aeef; box-shadow: 0 0 40px rgba(0, 174, 239, 0.2); } .club-logo { width: 90px; height: 90px; margin-bottom: 15px; filter: grayscale(1); opacity: 0.5; transition: 0.5s; } .unlocked .club-logo { filter: drop-shadow(0 0 15px #00aeef); opacity: 1; } .club-title { font-family: 'Orbitron'; color: #486581; font-size: 1.1rem; margin-bottom: 30px; letter-spacing: 3px; transition: 0.5s; } .unlocked .club-title { color: #00aeef; }

    .input-group { margin-bottom: 20px; }
    input { width: 100%; padding: 14px; background: #0b1d2e; border: 1px solid #486581; border-radius: 12px; color: white; text-align: center; box-sizing: border-box; outline: none; font-size: 1rem; transition: 0.3s; }
    input:focus { border-color: #00aeef; box-shadow: 0 0 10px rgba(0, 174, 239, 0.3); }
    
    .auth-gate { opacity: 0.1; pointer-events: none; transition: 0.5s; transform: scale(0.95); filter: blur(4px); }
    .auth-gate.active { opacity: 1; pointer-events: auto; transform: scale(1); filter: blur(0); }
    
    .divider { display: flex; align-items: center; margin: 20px 0; color: #486581; font-size: 0.7rem; }
    .divider::before, .divider::after { content: ""; flex: 1; height: 1px; background: #1a3a5a; margin: 0 10px; }
    
    .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: 900; cursor: pointer; transition: 0.3s; font-size: 0.9rem; margin-bottom: 15px; }
    .btn-google { background: white; color: #757575; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-google img { width: 18px; }
    .btn-google:hover { background: #f1f1f1; transform: translateY(-2px); }

    #lock-msg { color: #ff4d4d; font-size: 0.75rem; margin-top: 10px; display: none; background: rgba(255, 77, 77, 0.1); padding: 8px; border-radius: 8px; }
    #success-msg { color: #00aeef; font-size: 0.8rem; margin-top: 10px; font-weight: 900; display: none; }
</style>
</head> <body>

<div class="login-card" id="card">
    <img src="/images/logo.png" alt="LOGO" class="club-logo">
    <div class="club-title">MEMBER ACCESS</div>
    
    <div class="input-group">
        <input type="password" id="club-pass" placeholder="合言葉を入力">
        <div id="lock-msg">連続失敗によりロック中です。</div>
        <div id="success-msg">ACCESS GRANTED.</div>
    </div>

    <div id="google-gate" class="auth-gate">
        <div class="divider">AUTHENTICATION REQUIRED</div>
        <button class="btn btn-google" onclick="loginWithGoogle()">
            <img src="[https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg](https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg)" alt="G">
            Sign in with Google
        </button>
    </div>
</div>

<script src="/menu.js"></script>
<script>
    const MAX_ATTEMPTS = 5;
    const LOCK_TIME = 5 * 60 * 1000;
    // 合言葉「shino2026」のSHA-256ハッシュ値
    const HASHED_KEY = "84285703716616e2578508e82647043376045142171f1627883a48e8940e4f88";

    async function sha256(text) {
        const msgUint8 = new TextEncoder().encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function checkLock() {
        const lockUntil = localStorage.getItem('login_lock_until');
        if (lockUntil && Date.now() < lockUntil) {
            document.getElementById('club-pass').disabled = true;
            document.getElementById('lock-msg').style.display = 'block';
            return true;
        }
        return false;
    }

    document.getElementById('club-pass').addEventListener('input', async function(e) {
        if (checkLock()) return;
        
        const val = e.target.value;
        // shino2026は9文字なので、9文字以上の入力があった場合に判定
        if (val.length >= 9) { 
            const inputHashed = await sha256(val);
            
            if (inputHashed === HASHED_KEY) {
                document.getElementById('google-gate').classList.add('active');
                document.getElementById('card').classList.add('unlocked');
                document.getElementById('success-msg').style.display = 'block';
                e.target.disabled = true;
                e.target.style.borderColor = '#00aeef';
                localStorage.removeItem('login_attempts');
            } else {
                let attempts = parseInt(localStorage.getItem('login_attempts') || 0) + 1;
                localStorage.setItem('login_attempts', attempts);
                
                if (attempts >= MAX_ATTEMPTS) {
                    localStorage.setItem('login_lock_until', Date.now() + LOCK_TIME);
                    checkLock();
                } else {
                    e.target.value = "";
                    alert("合言葉が正しくありません。");
                }
            }
        }
    });

    function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider)
        .then(() => { window.location.href = "/activity-log.html"; })
        .catch((e) => { alert("認証に失敗しました。"); });
    }

    checkLock();
</script>
</body> </html>
