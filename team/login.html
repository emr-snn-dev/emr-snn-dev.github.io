<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUB LOGIN | 篠ノ井技術クラブ</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        body { background: #0b1d2e; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; overflow: hidden; }
        .login-card { background: rgba(16, 42, 67, 0.9); padding: 40px; border-radius: 20px; border: 1px solid #00aeef; box-shadow: 0 0 30px rgba(0, 174, 239, 0.4); text-align: center; width: 90%; max-width: 350px; }
        .club-logo { width: 100px; height: 100px; margin-bottom: 20px; filter: drop-shadow(0 0 10px #00aeef); }
        .club-title { font-family: 'Orbitron'; color: #00aeef; font-size: 1.2rem; margin-bottom: 30px; letter-spacing: 2px; }
        input[type="password"] { width: 100%; padding: 12px; margin-bottom: 20px; background: #0b1d2e; border: 1px solid #486581; border-radius: 8px; color: white; text-align: center; box-sizing: border-box; outline: none; }
        .enter-btn { width: 100%; padding: 12px; background: #00aeef; color: white; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .enter-btn:disabled { background: #486581; cursor: not-allowed; }
        #lock-msg { color: #ff4d4d; font-size: 0.8rem; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <script>
        // URLパラメータチェック：不正アクセスは即ホームへ
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('code') !== 'SNN_2026') {
            window.location.href = "/index.html";
        }
    </script>

    <div class="login-card">
        <img src="/images/logo.png" alt="LOGO" class="club-logo">
        <div class="club-title">MEMBER ONLY</div>
        <input type="password" id="club-pass" placeholder="PASSWORD">
        <button id="login-btn" class="enter-btn" onclick="checkClubPassword()">LOGIN</button>
        <div id="lock-msg">失敗しすぎたため5分間ロックされています</div>
    </div>

    <script src="/menu.js"></script>
    <script>
        const MAX_ATTEMPTS = 5;
        const LOCK_TIME = 5 * 60 * 1000; // 5分（ミリ秒）

        function checkLock() {
            const lockUntil = localStorage.getItem('login_lock_until');
            if (lockUntil && Date.now() < lockUntil) {
                document.getElementById('login-btn').disabled = true;
                document.getElementById('lock-msg').style.display = 'block';
                return true;
            }
            document.getElementById('login-btn').disabled = false;
            document.getElementById('lock-msg').style.display = 'none';
            return false;
        }

        // ページ読み込み時にロック確認
        setInterval(checkLock, 1000);

        async function checkClubPassword() {
            if (checkLock()) return;

            const inputPass = document.getElementById('club-pass').value;
            const guestEmail = "guest@snn.example.com"; 
            const guestPass = "shinonoi2026"; 

            if (inputPass === guestPass) {
                try {
                    const result = await firebase.auth().signInWithEmailAndPassword(guestEmail, guestPass);
                    localStorage.removeItem('login_attempts');
                    localStorage.removeItem('login_lock_until');
                    window.location.href = "/activity-log.html";
                } catch (e) { alert("認証エラー"); }
            } else {
                let attempts = parseInt(localStorage.getItem('login_attempts') || 0) + 1;
                localStorage.setItem('login_attempts', attempts);
                
                if (attempts >= MAX_ATTEMPTS) {
                    const lockUntil = Date.now() + LOCK_TIME;
                    localStorage.setItem('login_lock_until', lockUntil);
                    alert("5回失敗しました。5分間ロックします。");
                    checkLock();
                } else {
                    alert("パスワードが違います。残り: " + (MAX_ATTEMPTS - attempts) + "回");
                }
            }
        }
    </script>
</body>
</html>
