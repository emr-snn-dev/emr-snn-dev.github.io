<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ログイン | 篠ノ井技術クラブ</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <div id="loading"><h1>SYSTEM LOADING...</h1></div>
    <header><h1>TEAM PORTAL</h1></header>

    <main>
        <div class="card" style="max-width: 400px; margin: 0 auto;">
            <h3 id="form-title" style="text-align: center;">ログイン</h3>
            <div style="margin-top: 20px;">
                <input type="email" id="email" class="card" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; box-sizing: border-box;" placeholder="メールアドレス">
                <input type="password" id="password" class="card" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; box-sizing: border-box;" placeholder="パスワード">
                
                <button id="main-btn" onclick="handleAuth()" class="btn" style="width: 100%; margin-top: 20px; border: none;">ログイン</button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="javascript:void(0)" onclick="toggleMode()" id="toggle-text" style="font-size: 0.9rem; color: #007bff; text-decoration: none;">新規登録はこちら</a>
                </div>
                <p id="error-msg" style="color: #ff4757; font-size: 0.85rem; margin-top: 15px; text-align: center; font-weight: bold;"></p>
            </div>
        </div>
    </main>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBwT-Df-5F4Wdyg-nJfg1OPolTMNUN0srg",
            authDomain: "shinonoi-gizyutu.firebaseapp.com",
            projectId: "shinonoi-gizyutu",
            storageBucket: "shinonoi-gizyutu.firebasestorage.app",
            messagingSenderId: "650750036178",
            appId: "1:650750036178:web:f50da8d54383510b6dc50b"
        };
        firebase.initializeApp(firebaseConfig);

        let isLoginMode = true;

        function toggleMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('form-title').innerText = isLoginMode ? "ログイン" : "新規登録申請";
            document.getElementById('main-btn').innerText = isLoginMode ? "ログイン" : "アカウント作成";
            document.getElementById('toggle-text').innerText = isLoginMode ? "新規登録はこちら" : "ログインに戻る";
        }

        function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('main-btn');
            
            btn.innerText = "処理中...";
            btn.classList.add('processing');

            if (isLoginMode) {
                firebase.auth().signInWithEmailAndPassword(email, password)
                    .then(() => { window.location.href = "/team/index.html"; })
                    .catch((err) => {
                        btn.innerText = "ログイン";
                        btn.classList.remove('processing');
                        document.getElementById('error-msg').innerText = "認証失敗、または未承認です。";
                    });
            } else {
                firebase.auth().createUserWithEmailAndPassword(email, password)
                    .then(() => {
                        alert("登録完了！管理者が有効化するまでログインはできません。");
                        location.reload();
                    })
                    .catch((err) => {
                        btn.innerText = "アカウント作成";
                        btn.classList.remove('processing');
                        document.getElementById('error-msg').innerText = "登録エラー。";
                    });
            }
        }
    </script>
</body>
</html>
