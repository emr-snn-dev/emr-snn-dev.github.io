<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLOG | 篠ノ井技術クラブ</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <style>
        body { background: #0b1d2e; color: white; margin: 0; font-family: sans-serif; }
        .main-layout { max-width: 1000px; margin: 0 auto; padding: 100px 20px; }
        .blog-card { background: rgba(16, 42, 67, 0.4); border: 1px solid #1e3a5f; padding: 20px; border-radius: 10px; cursor: pointer; margin-bottom: 20px; }
        .category-label { background: #00aeef; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
        #blog-viewer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; overflow-y: auto; }
        .viewer-inner { max-width: 800px; margin: 50px auto; background: #0b1d2e; padding: 30px; border-radius: 15px; }
        /* 画像を表示する設定 */
        .markdown-body img { display: block; max-width: 100%; height: auto; margin: 20px 0; border-radius: 8px; }
    </style>
</head>
<body>
    <div id="nav-container"></div>
    <main class="main-layout">
        <div id="blog-list"></div>
    </main>
    <div id="blog-viewer">
        <div class="viewer-inner">
            <button onclick="closePost()">CLOSE</button>
            <div id="post-content" class="markdown-body"></div>
        </div>
    </div>
    <script src="/menu.js"></script>
    <script>
        const REPO = "emr-snn-dev/emr-snn-dev.github.io";
        async function initBlog() {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/blog`);
            const files = await res.json();
            const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();
            const list = document.getElementById('blog-list');
            
            for (const f of mdFiles) {
                const name = f.name.split('.')[0];
                const category = name.match(/\[(.*?)\]/)?.[1] || 'TECH';
                const title = name.replace(/\[.*?\]/, '').replace(/^\d+_/, '').replace(/-/g, ' ');
                
                const card = document.createElement('div');
                card.className = 'blog-card';
                card.onclick = () => openPost(f.download_url);
                card.innerHTML = `<span class="category-label">${category}</span><h3>${title}</h3>`;
                list.appendChild(card);
            }
        }
        async function openPost(url) {
            document.getElementById('blog-viewer').style.display = 'block';
            const res = await fetch(url);
            const md = await res.text();
            document.getElementById('post-content').innerHTML = marked.parse(md);
        }
        function closePost() { document.getElementById('blog-viewer').style.display = 'none'; }
        window.onload = initBlog;
    </script>
</body>
</html>
