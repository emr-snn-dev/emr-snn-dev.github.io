<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ACTIVITY LOG | 篠ノ井技術クラブ</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body style="background: #0b1d2e; color: white;" oncontextmenu="warnSave(); return false;">

    <div id="nav-container"></div>

    <header style="text-align:center; padding: 40px;">
        <h1 style="font-family:'Orbitron'; text-shadow: 0 0 10px #00aeef;">ACTIVITY LOG</h1>
        <p style="color:#00aeef; font-weight:900;">GITHUB REPO: /images/</p>
    </header>

    <main>
        <div id="auto-gallery" class="gallery-container"></div>
    </main>

    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <span class="close-btn">&times;</span>
        <img id="lightbox-img" src="">
    </div>

    <script src="/menu.js"></script>
    <script>
        // GitHub APIで /images/ フォルダのファイル一覧を取得
        const GITHUB_USER = "emr-snn-dev";
        const GITHUB_REPO = "emr-snn-dev.github.io"; // リポジトリ名
        const IMAGE_FOLDER = "images"; // 取得したいフォルダ名

        async function loadGithubImages() {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${IMAGE_FOLDER}`;
            const galleryArea = document.getElementById('auto-gallery');

            try {
                const response = await fetch(apiUrl);
                const files = await response.json();

                files.forEach(file => {
                    // 画像ファイル（jpg, png, gif, webp）のみを抽出
                    if (file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                        const div = document.createElement('div');
                        div.className = 'photo-item';
                        
                        // 文字表示機能（ファイル名に _txt が含まれる場合）
                        let label = "";
                        if(file.name.includes('_txt')) {
                            const cleanName = file.name.split('_txt')[0];
                            label = `<div class="photo-label">${cleanName}</div>`;
                        }

                        // 画像のパスは file.download_url または相対パスを使用
                        const imgUrl = file.download_url;
                        div.innerHTML = `<img src="${imgUrl}" class="secure-img" onclick="openLightbox('${imgUrl}')">${label}`;
                        galleryArea.appendChild(div);
                    }
                });
            } catch (e) {
                console.error("GitHubからの画像取得に失敗しました:", e);
            }
        }

        function openLightbox(url) {
            document.getElementById('lightbox-img').src = url;
            document.getElementById('lightbox').classList.add('active');
        }
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }
        function warnSave() {
            alert("セキュリティ保護のため、右クリックおよび画像の保存は禁止されています。");
        }

        // 実行
        loadGithubImages();
    </script>
</body>
</html>
